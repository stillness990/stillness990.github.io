<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Well Wang的blog">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Well Wang的blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Well Wang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Well Wang的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Well Wang的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/service/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/service/" class="post-title-link" itemprop="url">server服务教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:32:08" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start &lt;服务名&gt; <span class="comment">#启动服务</span></span><br><span class="line">sudo systemctl status &lt;服务名&gt; <span class="comment">#查看服务状态</span></span><br></pre></td></tr></table></figure>

<p>执行服务命令后输出如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled)</span><br><span class="line">   Active: active (running) since  2014-12-05 12:18:22 JST; 7min ago</span><br><span class="line"> Main PID: 4349 (httpd)</span><br><span class="line">   Status: <span class="string">&quot;Total requests: 1; Current requests/sec: 0; Current traffic:   0 B/sec&quot;</span></span><br><span class="line">   CGroup: /system.slice/httpd.service</span><br><span class="line">           ├─4349 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─4350 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─4351 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─4352 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─4353 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           └─4354 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line"></span><br><span class="line">12月 05 12:18:22 localhost.localdomain systemd[1]: Starting The Apache HTTP Server...</span><br><span class="line">12月 05 12:18:22 localhost.localdomain systemd[1]: Started The Apache HTTP Server.</span><br><span class="line">12月 05 12:22:40 localhost.localdomain systemd[1]: Started The Apache HTTP Server.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Loaded行：配置文件的位置，是否设为开机启动</li>
<li>Active行：表示正在运行</li>
<li>Main PID行：主进程ID</li>
<li>Status行：由应用本身（这里是 httpd ）提供的软件当前状态</li>
<li>CGroup块：应用的所有子进程</li>
<li>日志块：应用的日志</li>
</ul>
<h5 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> &lt;服务名&gt; <span class="comment">#开机启动</span></span><br></pre></td></tr></table></figure>

<p>相当于在/etc/systemd/system目录添加一个链接，指向/usr/lib/systemd/system里面的httpd.service文件。这是因为开机时，Systemd只执行/etc/systemd/system目录里面的配置文件。这也意味着，如果把修改后的配置文件放在该目录，就可以达到覆盖原始配置的效果。</p>
<h5 id="停止服务"><a href="#停止服务" class="headerlink" title="停止服务"></a>停止服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop &lt;服务名&gt; <span class="comment">#停止服务</span></span><br></pre></td></tr></table></figure>

<p>有时候，该命令可能没有响应，服务停不下来。这时候就不得不”杀进程”了，向正在运行的进程发出kill信号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">kill</span> httpd.service</span><br></pre></td></tr></table></figure>

<p>如果由于某种原因多次运行nginx怎么办。  我们怎么获取将PID？</p>
<p>systemd知道服务的PID，通过$MAINPID变量 我们可以获取到。</p>
<p>环境变量 $MAINPID 可用于表示主进程的PID， 例如可以这样使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">注意，像上例那样，通过向守护进程发送复位信号， 强制其重新加载配置文件，并不是一个好习惯。</span><br><span class="line"></span><br><span class="line"> 因为这是一个异步操作， 所以不适用于需要按照特定顺序重新加载配置文件的服务。</span><br><span class="line"></span><br><span class="line">我们强烈建议将 ExecReload= 设为一个 能够确保重新加载配置文件的操作同步完成的命令行</span><br><span class="line"></span><br><span class="line">![](/ssd/网站/img/220207-1.jpeg)</span><br><span class="line"></span><br><span class="line">![](/ssd/网站/img/220207-2.jpeg)</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">kill -s KILL pid #强制执行 同kill-9 pid</span><br></pre></td></tr></table></figure>

<p>这是一个强大和危险的命令迫使进程在运行是突然终止，进程在结束后不能自我清理</p>
<h5 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart httpd.service</span><br></pre></td></tr></table></figure>

<h4 id="service文件编写"><a href="#service文件编写" class="headerlink" title="service文件编写"></a>service文件编写</h4><blockquote>
<p>   一个服务怎么启动，完全由它的配置文件决定。下面就来看，配置文件有些什么内容。</p>
</blockquote>
<pre><code>前面说过，配置文件主要放在/usr/lib/systemd/system目录，也可能在/etc/systemd/system目录。找到配置文件以后，使用文本编辑器打开即可。
</code></pre>
<p>  systemctl cat命令可以用来查看配置文件，下面以sshd.service文件为例，它的作用是启动一个 SSH 服务器，供其他用户以 SSH 方式登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=OpenSSH server daemon</span><br><span class="line">Documentation=man:sshd(8) man:sshd_config(5)</span><br><span class="line">After=network.target sshd-keygen.service</span><br><span class="line">Wants=sshd-keygen.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/etc/sysconfig/sshd</span><br><span class="line">ExecStart=/usr/sbin/sshd -D <span class="variable">$OPTIONS</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">Type=simple</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>可以看到，配置文件分成几个区块，每个区块包含若干条键值对。<br>下面依次解释每个区块的内容。</p>
<h5 id="1-Unit"><a href="#1-Unit" class="headerlink" title="1. [Unit]"></a>1. [Unit]</h5><p>第一个区块，定义Unit元数据信息以及与其他服务的依赖关系<br>Description字段给出当前服务的简单描述，<br>Documentation字段给出文档位置。</p>
<ul>
<li><p>Description：服务描述信息</p>
</li>
<li><p>Documentation：服务文档地址(可选)</p>
</li>
<li><p>Before：如果该字段指定了其它Unit则代表该Unit需要在其它Unit启动之前启动，但是没有严格的依赖关系</p>
</li>
<li><p>After：如果该字段有指定了其它Unit则代表该Unit需要在其它Unit启动之后才能启动，但是没有严格的依赖关系</p>
<blockquote>
<p>注意，After和Before字段只涉及启动顺序，不涉及依赖关系。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>设置依赖关系，需要使用Wants字段和Requires字段。</p>
</blockquote>
<ul>
<li><p>Wants：与当前Unit配合的其他Unit，存在”弱依赖”关系,如果需要配合的Unit没有运行，当前Unit也能正常启动,</p>
</li>
<li><p>Requires：为当前Unit指定一个强依赖关系，如果该配置项所指定的Unit没有运行，则当前Unit无法启动。</p>
<blockquote>
<p>Wants字段与Requires字段只涉及依赖关系，与启动顺序无关，默认情况下是同时启动的。</p>
</blockquote>
</li>
<li><p>BindsTo：与Requires类似，如果指定的Unit发生退出，则当前Unit也会停止运行</p>
</li>
<li><p>Conflicts：指定冲突Unit，这里指定的Unit不能与当前Unit同时运行</p>
</li>
<li><p>Condition：当前Unit运行必须满足的条件，否则不会运行</p>
</li>
</ul>
<blockquote>
<p>关于Requires、After、Conflicts依赖的说明：<br>如果没有配置DefaultDependencies=no，那么该Unit会自动隐式添加Requires=sysinit.target, After=sysinit.target,After=basic.target, Conflicts=shutdown.target, Before=shutdown.target的依赖关系。这样是为了保证普通Unit在系统启动完毕之后才能启动、在关闭系统之前先被停止，只有需要在系统启动早期就必须启动的服务以及那些必须在关机动作的结尾才能停止的服务才需要设置DefaultDependencies=no。</p>
</blockquote>
<h5 id="2-Service"><a href="#2-Service" class="headerlink" title="2.[Service]"></a>2.[Service]</h5><p>通过该区域进行详细配置，如服务启动脚本、环境变量、配置文件名、重启方式等</p>
<p>许多软件都有自己的环境参数文件，该文件可以用EnvironmentFile字段读取。<br>EnvironmentFile字段：指定当前服务的环境参数文件。该文件内部的key=value键值对，可以用$key的形式，在当前配置文件中获取。<br>上面的例子中，sshd 的环境参数文件是/etc/sysconfig/sshd。</p>
<p>启动类型</p>
<ul>
<li><p>Type=simple：默认值，直接执行ExecStart选项所指定的命令ExecStart字段启动的进程为主进程</p>
</li>
<li><p>Type=forking：多数服务会在启动后放入后台，systemd通过Type=forking来支持这种工作方式。如果启用该项，建议同时设置PIDFile选项，这样可以帮助systemd更准确的定位到服务进程ExecStart字段将以fork()方式启动，此时父进程将会退出，子进程将成为主进程</p>
</li>
<li><p>Type=notify：确保服务启动后发送一个通知消息给systemd，systemd会在启动后面的服务之前确保该进程已经成功的发送了这个消息</p>
</li>
<li><p>Type=idle：若同时有其他任务在执行，需要等那些任务完成后才对当前服务进行处理<br>oneshot：类似于simple，但只执行一次，Systemd 会等它执行完，才启动其他服务</p>
<blockquote>
<p>下面是一个oneshot的例子，笔记本电脑启动时，要把触摸板关掉，配置文件可以这样写。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Switch-off Touchpad</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">ExecStart=/usr/bin/touchpad-off</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面的配置文件，启动类型设为oneshot，就表明这个服务只要运行一次就够了，不需要长期运行。</p>
</blockquote>
</li>
<li><p>dbus：类似于simple，但会等待 D-Bus 信号后启动<br>notify：类似于simple，启动结束后会发出通知信号，然后Systemd 再启动其他服务</p>
</li>
<li><p>PIDFile：配置Unit的PID文件路径，systemd将会在服务启动后从该文件中读取进程PID。建议Type=forking时明确配置该选项。如果设为相对路径表示相对于/run/目录。</p>
</li>
</ul>
<p>启动指令</p>
<ul>
<li><p>ExecStart：启动某个服务的具体命令，如果有变量的话则来自Environment所指定的配置文件，在所有的启动命令(Exec开头的命令)设置之前都可以加上一个连词号(-)，表示抑制错误，即发生错误的时候不影响其他命令的执行。比如EnvironmentFile=-/etc/sysconfig/sshd表示即使/etc/sysconfig/sshd文件不存在，也不会抛出错误。</p>
</li>
<li><p>ExecStartPre：启动某个服务之前执行的命令</p>
</li>
<li><p>ExecStartPost：启动某个服务之后执行的命令</p>
</li>
<li><p>ExecReload：重启服务时执行的命令，Unit需要重新载入配置时所执行的命令行，可通过kill命令结合一个环境变量$MAINPID来完成，如/bin/kill -HUP $MAINPID。如果服务有特定的重启命令，建议不要使用kill的方式</p>
</li>
<li><p>ExecStop：停止服务时执行的命令，如果没有指定的话则会按照kill的方式终止</p>
</li>
<li><p>ExecStopPost：服务停止之后需要执行的命令</p>
</li>
<li><p>RestartSec：自动重启当前服务间隔的秒数，如RestartSec=20s代表systemd自动重启之前需要等20秒。</p>
</li>
<li><p>Restart：定义Systemd自动重启当前服务的场景，比如always(除了使用命令systemctl stop停止服务，其他情况下都进行重启)、on-success、on-failure(发生意外退出就重启。如果是systemctl stop这种正常停止则不会重启)、on-abnormal、on-abort、on-watchdog</p>
</li>
<li><p>RestartPreventExitStatus：指定Unit在什么情况下的退出不需要自动重启，该参数的值支持exit状态码以及信号名2种写法，多个状态以空格分隔</p>
</li>
<li><p>TimeoutSec：定义Systemd停止当前服务时需要等待的秒数</p>
</li>
<li><p>Environment：指定Unit所需的环境变量，如Environment=”ONE=one”，ExecStart=echo $ONE</p>
</li>
<li><p>EnvironmentFile：指定Unit所需的环境变量配置文件，如ssh需要/etc/sysconfig/sshd</p>
</li>
</ul>
<h5 id="3-Install"><a href="#3-Install" class="headerlink" title="3. [Install]"></a>3. [Install]</h5><p>通常是配置文件最后一个区块，定义服务如何启动以及是否开机启动</p>
<p>默认即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>常用</p>
<ul>
<li>WantedBy：指定一个或多个Target(Target就是Unit组，启动某个Target的时候会启动里面所有的Unit，它的作用有点类似init的runlevel)，如WantedBy=multi-user.target代表服务所在的 Target是multi-user.target(多用户命令行状态专用Target，也是systemd默认Target)。这个设置比较重要，因为对某个Unit执行enable时，该Unit的软链接就会存放于/etc/systemd/system/multi-user.target.wants目录中(以Target名+.wants后缀构成)</li>
</ul>
<p>不常用</p>
<ul>
<li><p>RequiredBy：指定一个或多个Target，当Unit状态为enable时，服务的软连接文件会创建到/etc/systemd/system目录下面并以Target 名+.required后缀构成的子目录中</p>
</li>
<li><p>Alias：Unit别名</p>
</li>
<li><p>Also：当Unit设置为enable时，会被同时enable的其他Unit</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/syncthing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/syncthing/" class="post-title-link" itemprop="url">syncthing同步数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:32:08" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-服务器安装服务端这里以CentOS7"><a href="#1-服务器安装服务端这里以CentOS7" class="headerlink" title="1. 服务器安装服务端这里以CentOS7"></a>1. 服务器安装服务端这里以CentOS7</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/syncthing/syncthing/releases/download/v1.18.4/syncthing-linux-amd64-v1.18.4.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="2-解压压缩包"><a href="#2-解压压缩包" class="headerlink" title="2. 解压压缩包"></a>2. 解压压缩包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf syncthing-linux-amd64-v1.18.4.tar.gz</span><br></pre></td></tr></table></figure>

<h4 id="3-进入目录"><a href="#3-进入目录" class="headerlink" title="3. 进入目录"></a>3. 进入目录</h4><p><img src="https://img-blog.csdnimg.cn/92060cfc5cca4bbd998cb64424fadffb.png" alt="请添加图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd syncthing-linux-amd64-v1.18.4</span><br></pre></td></tr></table></figure>
<h4 id="4-增加可执行权限"><a href="#4-增加可执行权限" class="headerlink" title="4. 增加可执行权限"></a>4. 增加可执行权限</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x syncthing</span><br></pre></td></tr></table></figure>
<h4 id="5-先执行"><a href="#5-先执行" class="headerlink" title="5. 先执行"></a>5. 先执行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./syncthing</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/492955a3a93d4d32a338f26afb9dcf5a.png" alt="请添加图片描述"></p>
<h4 id="6-进行配置文件目录"><a href="#6-进行配置文件目录" class="headerlink" title="6. 进行配置文件目录"></a>6. 进行配置文件目录</h4><p>ctrl+c结束目前进程，刚才执行程序已经生成了配置文件，下面编辑配置文件<br>进入配置文件目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd .config/syncthing</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/cabdb69d6d8d4620a770ff31f713d7be.png" alt="请添加图片描述"><br>将里面的IP地址换成0.0.0.0:8384地址保存退出</p>
<h4 id="7-重新启动"><a href="#7-重新启动" class="headerlink" title="7. 重新启动"></a>7. 重新启动</h4><p>进入syncthing 目录下重新启动程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./syncthing</span><br></pre></td></tr></table></figure>
<h4 id="8-配置UI系统"><a href="#8-配置UI系统" class="headerlink" title="8.配置UI系统"></a>8.配置UI系统</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务器地址:8384</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/c5dd3032fb094b128255a3175fded9fc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV1dfc3RpbGw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="请添加图片描述"></p>
<h4 id="5-后台运行nohup表示后台运行"><a href="#5-后台运行nohup表示后台运行" class="headerlink" title="5. 后台运行nohup表示后台运行"></a>5. 后台运行nohup表示后台运行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./syncthing</span><br></pre></td></tr></table></figure>
<h4 id="6-windows端测试"><a href="#6-windows端测试" class="headerlink" title="6. windows端测试"></a>6. windows端测试</h4><p>windows自行找相应版本解压运行后本地浏览器输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8384</span><br></pre></td></tr></table></figure>
<p>选择相应的文件夹即可同步，速度不是太理想，可能服务器是海外的原因？<br><img src="https://img-blog.csdnimg.cn/b445974bb66947ff9e280b2a1b30f126.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV1dfc3RpbGw=,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h4 id="7-windows下开机启动"><a href="#7-windows下开机启动" class="headerlink" title="7. windows下开机启动"></a>7. windows下开机启动</h4><p>使用启动文件夹在用户登录时运行</p>
<ol>
<li>复制并粘贴 到 Windows 资源管理器的地址栏中，然后按 Enter。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup</span><br></pre></td></tr></table></figure></li>
<li>右键单击文件夹中的空白区域并选择“新建”，然后选择“快捷方式”。</li>
<li>在“键入项目的位置：”中输入路径，syncthing.exe后跟（例如）。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\syncthing\syncthing.exe --no-console --no-browser</span><br></pre></td></tr></table></figure>
点击下一步”。</li>
</ol>
<p>点击“完成”。</p>
<p>Syncthing 现在将在您下次登录 Windows 用户帐户时自动启动。不会弹出控制台或浏览器窗口，但您仍然可以通过在 Web 浏览器中打开<a target="_blank" rel="noopener" href="http://localhost:8384/">http://localhost:8384</a>来访问该界面。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85nginx/" class="post-title-link" itemprop="url">ubuntu下安装nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:32:09" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>下载nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.18.0.tar.gz</span><br></pre></td></tr></table></figure>

<ol>
<li>解压nginx(由于我新建的文件夹需要root权限 所以加上sudo)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf nginx-1.18.0.tar.gz -C /usr/local/nginx/</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编译安装</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx</span><br><span class="line">./configure</span><br></pre></td></tr></table></figure>

<p>发生报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either disable the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install libpcre3 libpcre3-dev</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>重新编译</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --user=nobody --group=nobody --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_gzip_static_module --with-http_realip_module --with-http_sub_module --with-http_ssl_module</span><br></pre></td></tr></table></figure>

<p>还是报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/configure: error: SSL modules require the OpenSSL library.</span><br><span class="line">You can either do not enable the modules, or install the OpenSSL library</span><br><span class="line">into the system, or build the OpenSSL library statically from the source</span><br><span class="line">with nginx by using --with-openssl=&lt;path&gt; option.</span><br><span class="line"># centos需要安装install the OpenSSL library</span><br><span class="line"># ubuntu需要安装sudo apt-get install libssl-dev</span><br></pre></td></tr></table></figure>

<p>重新编译安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ./configure --user=nobody --group=nobody --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_gzip_static_module --with-http_realip_module --with-http_sub_module --with-http_ssl_module</span><br><span class="line">sudo make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>执行文件地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sgin/nginx</span><br></pre></td></tr></table></figure>

<p>配置文件地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E4%BD%BF%E7%94%A8hexo+github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E4%BD%BF%E7%94%A8hexo+github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" class="post-title-link" itemprop="url">使用hexo搭建博客github托管</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:34" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一-安装hexo"><a href="#一-安装hexo" class="headerlink" title="一. 安装hexo"></a>一. 安装hexo</h4><ol>
<li>下载node.js</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wget https://cdn.npmmirror.com/binaries/node/v16.15.0/node-v16.15.0-linux-x64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>解压</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf node-v16.15.0-linux-x64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>还是移动node.js 文件夹到/usr/local/node文件夹</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">mkdir node</span><br><span class="line">sudo mv node-v16.13.2-linux-x64 /usr/local/node</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>编辑~/.bash_profile</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Nodejs</span><br><span class="line">export PATH=/usr/local/node/node-v12.16.3-linux-x64/bin:$PATH</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>刷新使之生效</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看版本</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -V</span><br><span class="line">npm -V</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>安装cnpm淘宝镜像源</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>查看cnpm是否安装好</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm -v</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>接下来使用cnpm安装hexo</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>验证是否安装好hexo</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>建立一个空的博客文件夹</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir blog</span><br></pre></td></tr></table></figure>

<ol start="12">
<li>初始化blog需要挺长时间</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo hexo init</span><br><span class="line"># 提示INFO Start blogging with Hexo !就是初始化完成</span><br></pre></td></tr></table></figure>

<ol start="13">
<li>启动hexo</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br><span class="line"># 和docsifyu一样会在本地一个随机端口启动一个web页面，这格式化打开可以预览导我们搭建好的博客页面</span><br><span class="line"># hexo的博客文件也是支持md格式的</span><br></pre></td></tr></table></figure>

<ol start="14">
<li>新建一个博客文章</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hexo n &quot;第一篇博客&quot; #简单编辑一些内容</span><br><span class="line"># 返回说明我们的刚才新建的文章的路径</span><br><span class="line"># 我们进入这个路径就可以看到刚才新建的文章了</span><br><span class="line"></span><br><span class="line">15. 清理一下</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>hexo clean</p>
<pre><code>16. 生成博客

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>
# 经过hexo处理后就生成了一片博客了
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 二. 部署到github</span><br><span class="line"></span><br><span class="line">1. 登录你的github</span><br><span class="line">2. 新建一个仓库，此时你的仓库名必须符合特定要求才行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
githubID.github.io #githubID为你的帐号名，部署好以后也可以通过这个名字访问你的博客
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 安装github插件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
cnpm install --save hexo-deployer-git
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 编辑_config.yml文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
nano _config.yml #vim也可以安装自己的习惯
在# Deployment下新增
type:git #声明git
repo:https://github.com/githubID/githubID.github.io.git #指定仓库名
branch:master #v指定分支
ctrl+o #保存
ctrl+X #退出
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. 部署导git</span><br><span class="line"></span><br></pre></td></tr></table></figure>
hexo d
#部署的过程中会提示输入你的github帐号和密码
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6. 到此刷新仓库即可看到我们刚刚的博客文件到了github仓库此时也可以通过git仓库名看到你的搭建的博客</span><br><span class="line"></span><br><span class="line">PS 换主题</span><br><span class="line"></span><br><span class="line">1. 下载主题</span><br><span class="line"></span><br></pre></td></tr></table></figure>
git clone https://github.com/litten/hexo-theme-yilia.git themes/yilia
# 下载的主题在/themes这个文件夹里
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 配置主题编辑_config.yml文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
nano _config.yml #vim也可以安装自己的习惯
在#Extensions下
theme:yilia
ctrl+o #保存
ctrl+X #退出
hexo clean
hexo g           #重新生成一下
hexo s           #重新启动
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 重新推到github</span><br><span class="line"></span><br></pre></td></tr></table></figure>
hexo d
```
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E4%BD%BF%E7%94%A8nethogs%E7%9B%91%E8%A7%86%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E4%BD%BF%E7%94%A8nethogs%E7%9B%91%E8%A7%86%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">服务器使用nethogs监视网络</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:36" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有很多适用于Linux系统的开源网络监视工具。比如说，你可以用命令iftop来检查带宽使用情况。netstat用来查看接口统计报告，还有top监控系统当前运行进程。但是如果你想要找一个能够按进程实时统计网络带宽利用率的工具，那么NetHogs值得一看。<br>NetHogs是一个开源的命令行工具（类似于Linux的top命令），用来按进程或程序实时统计网络带宽使用率。<br>来自NetHogs项目网站:</p>
<blockquote>
<p>NetHogs是一个小型的net top工具，不像大多数工具那样拖慢每个协议或者是每个子网的速度而是按照进程进行带宽分组。NetHogs不需要依赖载入某个特殊的内核模块。如果发生了网络阻塞你可以启动NetHogs立即看到哪个PID造成的这种状况。这样就很容易找出哪个程序跑飞了然后突然占用你的带宽。</p>
</blockquote>
<h5 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h5><p>Unix/Linux操作系统下如何安装和使用NetHogs按进程监控网络带宽使用率。<br>在RHEL、CentOS和Fedora下安装NetHogs</p>
<p>要安装NetHogs，你必须要启用你所用Linux下的EPEL源。<br>安装依赖包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install libpcap libpcap-devel epel-release -y</span></span><br></pre></td></tr></table></figure>
<p>安装epel源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install epel-release -y</span></span><br></pre></td></tr></table></figure>
<p>然后运行下面的yum命令下载安装NetHogs包。在Ubuntu、Linux mint和Debian下安装NetHogs<br>键入apt-get命令安装NetHogs包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install nethogs</span><br></pre></td></tr></table></figure>
<h5 id="2-NetHogs使用"><a href="#2-NetHogs使用" class="headerlink" title="2. NetHogs使用"></a>2. NetHogs使用</h5><p>在基于RedHat系统下键入如下命令启动NetHogs工具。<br>nethogs<br>在Debian/Ubuntu/Linux Mint下要执行NetHogs你必须拥有root权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nethogs</span><br></pre></td></tr></table></figure>
<p>NetHogs 命令行参数<br>以下就是NetHogs命令行的参数，用-d来添加刷新频率参数，device name 用来检测给定的某个或者某些设备的带宽（默认是eth0）。例如：设置5秒钟的刷新频率，键入如下命令即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nethogs -d 5</span></span><br><span class="line">$ sudo nethogs -d 5</span><br></pre></td></tr></table></figure>
<p>如果只用来监视设备（eth0）的网络带宽可以使用如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nethogs eth0</span></span><br><span class="line">$ sudo nethogs eth0</span><br><span class="line">````</span><br><span class="line">如果要同时监视eth0和eth1接口，使用以下命令即可：</span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># nethogs eth0 eth1</span></span><br><span class="line">$ sudo nethogs eth0 eth1</span><br><span class="line">````</span><br><span class="line">其他参数和用法</span><br><span class="line">````bash</span><br><span class="line">-d : 刷新间隔</span><br><span class="line">-h : 帮助</span><br><span class="line">-p : promiscious 模式</span><br><span class="line">-t : trace模式</span><br><span class="line">-V : 版本</span><br><span class="line">````</span><br><span class="line">交互命令</span><br><span class="line">以下是NetHogs的一些交互命令（键盘快捷键）</span><br></pre></td></tr></table></figure>
<p>m : 修改单位<br>r : 按流量排序<br>s : 按发送流量排序<br>q : 退出命令提示符</p>
<pre><code>关于NetHogs命令行工具的完整参数列表，可以参考NetHogs的手册，使用方法是在终端里输入man nethogs或者sudo man nethogs，更多信息请参考NetHogs项目主页。
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E5%B0%86%E7%A8%8B%E5%BA%8F%E6%B3%A8%E5%86%8C%E4%B8%BAlinux%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E5%B0%86%E7%A8%8B%E5%BA%8F%E6%B3%A8%E5%86%8C%E4%B8%BAlinux%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/" class="post-title-link" itemprop="url">程序注册为linux系统服务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:32" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1，新建服务文件"><a href="#1，新建服务文件" class="headerlink" title="1，新建服务文件"></a>1，新建服务文件</h4><p>每一个服务在Linux有它自己的对应的配置文件，这个文件可以通过文本编辑器编辑，扩展名为xxx.servive（xxx为服务名称）。这些文件位于/usr/lib/systemd/system目录下。</p>
<p>在这个目录下新建service文件即可创建我们的服务。文件的内容结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=服务描述</span><br><span class="line">After=服务依赖（再这些服务后启动本服务）</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=服务类型</span><br><span class="line">ExecStart=启动命令</span><br><span class="line">ExecStop=终止命令</span><br><span class="line">ExecReload=重启命令</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=服务安装设置</span><br></pre></td></tr></table></figure>

<p>可见服务配置文件分为[Unit]、[Service]和[Install]三大部分。</p>
<p>一般来说有些值是固定的，没有特殊需要我们直接套用即可。例如[Unit]中After的值一般是：network.target remote-fs.target nss-lookup.target。</p>
<p>[Install]的WantedBy一般是multi-user.target。</p>
<p>[Service]中是主要参数。</p>
<p>Type的值有以下几个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">simple：这是默认的值，指定了ExecStart设置后，simple就是默认的Type设置除非指定Type。simple使用ExecStart创建的进程作为服务的主进程，在此设置下systemd会立即启动服务。</span><br><span class="line"></span><br><span class="line">forking：如果使用了这个值，则ExecStart的脚本启动后会调用fork()函数创建一个进程作为其启动的一部分。当初始化完成，父进程会退出。子进程会继续作为主进程执行。</span><br><span class="line"></span><br><span class="line">oneshot：类似simple，但是在systemd启动之前，进程就会退出。这是一次性的行为。可能还需要设置RemainAfterExit=yes，以便systemd认为j进程退出后仍然处于激活状态。</span><br><span class="line"></span><br><span class="line">dbus：也和simple很相似，该配置期待或设置一个name值，通过设置BusName=设置name即可。</span><br><span class="line"></span><br><span class="line">notify：同样地，与simple相似的配置。顾名思义，该设置会在守护进程启动的时候发送推送消息。</span><br></pre></td></tr></table></figure>
<p>其实常用的就是simple和forking了。一般来说我们的程序是应用程序前台使用就用simple，后台/守护进程一般是forking。</p>
<p>然后就是启动/停止/重启命令，注意这个命令里面调用的程序必须全部使用绝对路径。</p>
<p>例如，我的服务器上的redis的Service配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=syncthing</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=<span class="built_in">arch</span></span><br><span class="line">ExecStart=/usr/bin/syncthing</span><br><span class="line">ExecStop=<span class="built_in">kill</span> -9 $(pidof syncthing)</span><br><span class="line">ExecReload=<span class="built_in">kill</span> -9 $(pidof syncthing) &amp;&amp; /usr/bin/syncthing</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kill -9 $(pidof syncthing)命令的意思是：先用pidof命令获取指定名称进程的pid再把这个结果传给kill命令终止对应进程。平时终止特定名称的进程时也可以这么写。</p>
<p>其实除此之外，service文件还有很多配置项，这里只写出了常用必要的，满足日常需求，其余可以自行搜索学习，这里不再过多赘述。</p>
<h4 id="2-启动-停止-重启服务"><a href="#2-启动-停止-重启服务" class="headerlink" title="2. 启动/停止/重启服务"></a>2. 启动/停止/重启服务</h4><p>刚刚建立好了我们的服务配置，现在就可以使用了！在此之前需要先使用下列命令让系统重新读取所有服务文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload <span class="comment">#修改service文件后必须先重新加载一遍</span></span><br></pre></td></tr></table></figure>

<p>然后通过以下命令操控服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line"></span><br><span class="line">systemctl start &lt;服务名&gt;.service</span><br><span class="line"><span class="comment"># 终止服务</span></span><br><span class="line"></span><br><span class="line">systemctl stop &lt;服务名&gt;.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line">systemctl restart &lt;服务名&gt;.service</span><br></pre></td></tr></table></figure>

<p>我的服务文件是redis-server.service，那么我的服务名是redis-server。</p>
<p>其实我们执行启动服务命令时，就会执行我们刚刚配置文件中ExecStart的值的命令，同样终止、重启会对应执行配置文件中ExecStop、ExecReload的值的命令。</p>
<h4 id="3-开机自动启动"><a href="#3-开机自动启动" class="headerlink" title="3. 开机自动启动"></a>3. 开机自动启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> 服务名</span><br><span class="line"><span class="comment"># Created symlink /etc/systemd/system/multi-user.target.wants/syncthing.service → /usr/lib/systemd/system/syncthing.service.</span></span><br><span class="line">这里在/etc/systemd/system/multi-user.target.wants/目录下创建了一个/usr/lib/systemd/system/syncthing.service文件的软链接，到这里设置开机自启动就完成了。</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用开机自启</span></span><br><span class="line">systemctl <span class="built_in">disable</span> 服务名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Description：运行软件描述</span><br><span class="line">Documentation：软件的文档</span><br><span class="line">After：因为软件的启动通常依赖于其他软件，这里是指定在哪个服务被启动之后再启动，设置优先级</span><br><span class="line">Wants：弱依赖于某个服务，目标服务的运行状态可以影响到本软件但不会决定本软件运行状态</span><br><span class="line">Requires：强依赖某个服务，目标服务的状态可以决定本软件运行。</span><br><span class="line">ExecStart：执行命令</span><br><span class="line">ExecStop：停止执行命令</span><br><span class="line">ExecReload：重启时的命令</span><br><span class="line">Type：软件运行方式，默认为simple</span><br><span class="line">WantedBy：这里相当于设置软件，选择运行在linux的哪个运行级别，只是在systemd中不在有运行级别概念，但是这里权当这么理解。  </span><br></pre></td></tr></table></figure>

<p>系统服务未启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">× syncthing.service - syncthing</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/syncthing.service; enabled; vendor preset: disabled)</span><br><span class="line">     Active: failed (Result: exit-code) since Sat 2022-02-05 19:37:28 CST; 1min 6s ago</span><br><span class="line">   Main PID: 5150 (code=exited, status=0/SUCCESS)</span><br></pre></td></tr></table></figure>

<p>系统服务正常启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">syncthing.service - syncthing</span><br><span class="line">    Loaded: loaded (/usr/lib/systemd/system/syncthing.service; enabled; vendor preset: disabled)</span><br><span class="line">    Active: active (running) since Sat 2022-02-05 19:38:53 CST; 2s ago</span><br><span class="line">  Main PID: 5605 (syncthing)</span><br><span class="line">     Tasks: 21 (limit: 9415)</span><br><span class="line">    Memory: 63.0M</span><br><span class="line">       CPU: 3.172s</span><br><span class="line">    CGroup: /system.slice/syncthing.service</span><br><span class="line">            ├─5605 /usr/bin/syncthing</span><br><span class="line">            └─5615 /usr/bin/syncthing</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ps</p>
<p>这里找到一个大老翻译的linux的<a href="http://www.jinbuguo.com/systemd/systemd.unit.html#" target="_blank">service手册供参考</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E5%B9%B4%E5%BA%A62021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E5%B9%B4%E5%BA%A62021/" class="post-title-link" itemprop="url">2021年年度总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:33" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li> 使用树梅派搭建个人nas系统</li>
<li> 使用aws韩国服务器搭建frp给自己的树梅派nas系统做内网穿透</li>
<li> 使用阿里云服务器做NextCloud做临时云盘存储文件</li>
<li> 使用阿里云服务器搭建KMS系统激活windows和office</li>
<li> 使用aws日本服务器做syncthing同步工作文件和数据</li>
<li> 使用aws韩国服务器和阿里云服务器做syncthing中继服务器</li>
<li> 使用树梅派制作软路由</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E5%B9%B4%E5%BA%A62022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E5%B9%B4%E5%BA%A62022/" class="post-title-link" itemprop="url">2022年读总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:33" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p> 使用aws韩国服务器搭建nginx+docsify个人技术博客</p>
</li>
<li><p> 使用aws韩国服务器搭建syncthing中继服务器</p>
</li>
<li><p> 给个人博客配置免费安全ssl证书</p>
</li>
<li><p> 将aws韩国和阿里云北京服务器设置成私有中继服务器</p>
</li>
<li><p> 将自己的电脑syncthing设置成系统服务并开机启动</p>
</li>
<li><p>aws的韩国centos韩国服务器设置nginx系统服务并设置开机自启动</p>
<p> ……..</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E6%90%AD%E5%BB%BAsyncthing%E4%B8%AD%E7%BB%A7%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E6%90%AD%E5%BB%BAsyncthing%E4%B8%AD%E7%BB%A7%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">syncthing 中继服务器搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:29" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>–<br>发现周末的时候syncthing的公共中继服务器的速度太慢，于是找了网上的资料打算自己搭建中继服务器</p>
<h4 id="1-服务器部署"><a href="#1-服务器部署" class="headerlink" title="1. 服务器部署"></a>1. 服务器部署</h4><p>1.1 此处linux服务器为例，<strong>此处注意一点要打开22067端口</strong><br>下载中继服务器，根据不同的版本</p>
<pre><code>wget https://github.com/syncthing/relaysrv/releases/download/v1.3.0/strelaysrv-linux-amd64-v1.3.0.tar.gz
</code></pre>
<p>1.2 解压压缩包</p>
<pre><code>tar -zxvf strelaysrv-linux-amd64-v1.3.0.tar.gz
</code></pre>
<p>1.3 进入目录</p>
<pre><code>cd strelaysrv-linux-amd64-v1.3.0
</code></pre>
<p>1.4 运行程序</p>
<pre><code>./strelaysrv #默认中继服务器启动后会加入公共中继池供其他人共同使用
</code></pre>
<p>文件地址</p>
<pre><code>/usr/local/syncthinx/strelaysrv-linux-amd64-v1.3.0
</code></pre>
<p>测试执行文件</p>
<pre><code>/usr/local/syncthinx/strelaysrv-nux-amd64-v1.3.0/./strelaysrv -pools=&quot;&quot;
</code></pre>
<p>1.5 使用ctrl+c，结束进程</p>
<p>1.6 复制设备ID</p>
<pre><code>relay://0.0.0.0:22067/?id=UT74OCE-CGTLWVZ-GAHTLHM-YHJHJQU-GEJ7QFW-ZRL7SNP-7LTHSOZ-RUR5BAK&amp;pingInterval=1m0s&amp;networkTimeout=2m0s&amp;sessionLimitBps=0&amp;globalLimitBps=0&amp;statusAddr=:22070&amp;providedBy=

relay://0.0.0.0:22067/?id=5NA226G-JNGYPZ5-E2RYJUQ-S2TTMQC-QE55DHT-YD5GDJI-VZHPGZK-7T4PHAI&amp;pingInterval=1m0s&amp;networkTimeout=2m0s&amp;sessionLimitBps=0&amp;globalLimitBps=0&amp;statusAddr=:22070&amp;providedBy=
</code></pre>
<p>此处将0.0.0.0改为服务器地址并记录下来</p>
<h4 id="2-客户端搭建"><a href="#2-客户端搭建" class="headerlink" title="2. 客户端搭建"></a>2. 客户端搭建</h4><p>在客户端的设置&gt;协议监听地址出粘贴上我们刚刚记录的东西</p>
<p><img src="https://img-blog.csdnimg.cn/1050fb49f4b74c65bc4e73510cdc472d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV1dfc3RpbGw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>ps：我使用的日本服务器中云备份，使用韩国和国内阿里云轻量服务器做中继服务器</p>
<h4 id="3-升级问题"><a href="#3-升级问题" class="headerlink" title="3. 升级问题"></a>3. 升级问题</h4><pre><code>sudo chown centos:centos * # 设置程序用户组后可以不必登录服务器后台直接在web管理页面点击升级
</code></pre>
<h4 id="4-设置私有中继服务器"><a href="#4-设置私有中继服务器" class="headerlink" title="4. 设置私有中继服务器"></a>4. 设置私有中继服务器</h4><ol>
<li> 结束进程</li>
</ol>
<pre><code> ps -ef | grep strelaysrv
</code></pre>
<ol start="2">
<li> 公私有中继服务器设置</li>
</ol>
<pre><code>-pools=&lt;pool addresses&gt; #官网说明，如果&lt;&gt;里为空则是私有中继服务器

./syncthing -pools=&quot;&quot; #私有中继,
# 启动后设备码可能会变动，这个需要记录下来
# 多个中继服务器之间可以使用,隔开
# 在web UI协议监听地址中加入default可以使用公共中继池
</code></pre>
<ol start="3">
<li> 后台启动</li>
</ol>
<pre><code>nohup ./syncthing -pools=&quot;&quot; &amp;
</code></pre>
<p>官网给出了详细的参数配置 <a target="_blank" rel="noopener" href="https://docs.syncthing.net/users/strelaysrv.html#description">Syncthing Relay Server</a>，上面提到的不再重复</p>
<pre><code>-global-rate=&lt;bytes/s&gt; #全局限速，bytes作为单位
</code></pre>
<p>附：<a href="https://relays.syncthing.net/" target="_blank">全球中继服务器地图</a>,这里可以看到全球的syncthing中继服务器位置和流量</p>
<h4 id="5-注册系统服务开机启动"><a href="#5-注册系统服务开机启动" class="headerlink" title="5. 注册系统服务开机启动"></a>5. 注册系统服务开机启动</h4><p>中继服务器程序地址</p>
<pre><code>/home/admin/strelaysrv-linux-amd64-v1.3.0/strelaysrv -pools=&quot;&quot; #ubuntu

/usr/local/syncthinx/strelaysrv-linux-amd64-v1.3.0/strelaysrv -pools=&quot;&quot; #centos
</code></pre>
<p>编辑service</p>
<pre><code>[Unit]
Description=strelaysrv
After=network.target
[Service]
Type=simple
User=centos
ExecStart=/usr/local/syncthinx/strelaysrv-linux-amd64-v1.3.0/./strelaysrv -pools=&quot;&quot;
ExecStop=kill -9 $(pidof strelaysrv)
ExecReload=kill -9 $(pidof strelaysrv) &amp;&amp; /usr/local/syncthinx/strelaysrv-linux-amd64-v1.3.0/./strelaysrv -pools=&quot;&quot;
[Install]
WantedBy=multi-user.target
</code></pre>
<p>报错检查服务日志</p>
<pre><code> [/usr/lib/systemd/system/strelaysrv.service:7] Unknown lvalue &#39;ExecStar&#39; in section &#39;Service&#39;
nal systemd[1]: [/usr/lib/systemd/system/strelaysrv.service:8] Executable path is not absolute, ignoring: kill -9 $(pidof
nal systemd[1]: [/usr/lib/systemd/system/strelaysrv.service:9] Executable path is not absolute, ignoring: kill -9 $(pidof
nal systemd[1]: strelaysrv.service lacks both ExecStart= and ExecStop= setting. Refusing.
</code></pre>
<p>发现拼写错误</p>
<p>继续运行服务</p>
<p>日志：</p>
<pre><code>strelaysrv.service: main process exited, code=exited, status=1/FAILURE
Unit strelaysrv.service entered failed state.
strelaysrv.service failed.
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAkms%E6%9C%8D%E5%8A%A1-vol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Well Wang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Well Wang的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAkms%E6%9C%8D%E5%8A%A1-vol/" class="post-title-link" itemprop="url">搭建kms服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-05 00:00:00 / 修改时间：15:31:30" itemprop="dateCreated datePublished" datetime="2022-06-05T00:00:00+08:00">2022-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>利用云服务器搭建kms系统激活windows系统和office，这里使用的是阿里云服务器</p>
</blockquote>
<ol>
<li>下载<br>在任意环境中，下载最新的vlmcsd releases版本。如在Ubuntu中，可以使用wget下载：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/Wind4/vlmcsd/releases/download/svn1112/binaries.tar.gz</span><br></pre></td></tr></table></figure></li>
<li> 解压并进入目录<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf binaries.tar.gz</span><br><span class="line">cd binaries/Linux/intel/static</span><br></pre></td></tr></table></figure></li>
<li>你的Ubuntu系统版本，执行相应的命令。例如我的Ubuntu是x64位的系统，所以执行以下命令：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./vlmcsdmulti-x64-musl-static/vlmcsd</span><br></pre></td></tr></table></figure></li>
<li>查看运行情况<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep vlmcsd</span><br></pre></td></tr></table></figure></li>
<li>打开端口</li>
</ol>
<p>  kms服务器需要使用1688端口，所以需要打开云服务器的相应端口</p>
<ol start="6">
<li>激活windows系统<br>windows系统使用管理员模式打开cmd</li>
</ol>
<p>​    输入以下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slmgr /skms 服务器IP地址</span><br></pre></td></tr></table></figure>
<p>接着输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slmgr /ato</span><br></pre></td></tr></table></figure>
<p>弹出窗口显示激活</p>
<ol start="7">
<li>激活office<br>管理员模式打开cmd，找到office文件中oscript文件的位置<br>使用cmd里以下命令以执行注册kms服务器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript ospp.vbs /sethst:服务器IP地址  </span><br></pre></td></tr></table></figure>
<p>一般ospp.vbs可以拖进去cmd窗口，所以也可以这么弄：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript &quot;C:\Program Files (x86)\Microsoft</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Office\Office16\OSPP.VBS&quot; /sethst:服务器IP地址</span><br></pre></td></tr></table></figure>
<p>一般来说office不会马上连接kms服务器进行激活，所以我们额外补充一条手动激活命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript ospp.vbs /act</span><br></pre></td></tr></table></figure>
<p>如果提示看到successful的字样，那么就是激活成功了，重新打开office就好。<br>一般来说，“一句命令已经完成了”，但一般office不会马上连接kms服务器进行激活，所以我们额<br>如果提示看到successful的字样，那么就是激活成功了，重新打开office就好</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Well Wang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Well Wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
